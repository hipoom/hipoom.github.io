---
title: 摘要、签名与数字证书都是什么？
date: 2024-08-05 23:36:10
tags:
---

# 1. 消息摘要（Digest）

#### 什么是消息摘要？
对一份数据，进行一个单向的 Hash 函数，生成一个固定长度的 Hash 值，这个值就是这份数据的摘要，也称为指纹。

#### 摘要算法
常见的摘要算法有 MD5、SHA-1、SHA-256 等。他们都有这些特点：

* 对于同一个摘要算法，无论输入的数据是什么，输出都是相同长度的值。
例如 MD5，无论数据有多大，输出总是128位的散列值。

* 摘要算法是单向的，只能根据原始数据计算出它的摘要值，但是不能根据摘要值反算出原始数据。

* 越优秀的摘要算法越难找到Hash碰撞。
虽然长内容生成短摘要是必定会产生碰撞的，但一个优秀的摘要算法很难主动构造出两条数据，使得他们的摘要值相同。

* 消息摘要的用途：可以用于校验数据的完整性。
例如我们在下载文件时，数据源会提供一个文件的MD5。文件下载好之后，我们本地计算出文件的MD5，和数据源提供的MD5做对比，如果相同则文件是完整的。
但独立使用消息摘要时，无法确保数据没有被篡改，因为无法保证从数据源获取的MD5有没有被中途篡改。

* 相比加密算法，摘要算法速度都相对较快。


---


## 2. 数字签名（Signature）

在了解签名之前，需要了解什么是公开密钥体系：

**公开密钥密码体系：**
基于大整数的因数分解可以生成一对公钥和私钥。公钥和私钥是一一对应关系，一把私钥有着和它唯一对应的公钥，反之亦然。用公钥加密的数据，只能用和它对应的私钥解密，用私钥加密也只能同与之对应的公钥解密。
密钥对的生成很快速，但根据公钥反推私钥是极其困难的事。

根据公开密钥密码体系，我们有了非对称加密。常见的非对称加密是 RSA 加密。

如果用「公钥」对数据加密，用「私钥」去解密，这是「加密」；
反之用「私钥」对数据加密，用「公钥」去解密，这是「签名」。

简单地看，似乎没有区别，只是换了个名字。但实际上，两者的用途完全不一样。
由于所有人都持有公钥，所以「签名」并不能保证数据的安全性，因为所有人都可以用公钥去解密。
但「签名」却能用于保证消息的准确性和不可否认性。**因为公钥和私钥是一一对应的，所以当一个公钥能解密某个密文时，说明这个密文一定来自于私钥持有者**。

我们来看一下具体**签名和验证的过程**：
1. 消息发送者持有 私钥 和 加密算法，称为信源；信源用私钥和加密算法对明文数据进行加密，得到密文数据，称为签体；
2. 接着把明文数据和密文数据同时给到消息接收者；
3. 消息接收者收到后，先取出密文数据，用公钥对密文解密，得到一份明文数据；
4. 再将这份明文数据和收到的明文数据做对比，如果相同则数据完整且可信。

![签名验证过程](./1.webp)


即使他人截获并篡改了「明文数据」，由于「私钥」是保密的，篡改者也无法生成正确的「签体」。所以签名能保证消息的准确性。
但在单独使用非对称加密的数字签名方案时，要对所有明文消息进行加密，效率很低。怎么提高效率呢？

**更高效的数字签名方案：** 将摘要算法和非对称加密结合使用。
如何签名：先用摘要算法计算明文数据的摘要值，再对这个摘要值用私钥加密。这样就能较快速地得到了原始信息的签名；
如何验证：先用相同的摘要算法计算原始信息的摘要值，再用公钥对签名解密，得到收到的摘要值，最后对比这两个摘要值判断是否相等。如果不相等说明数据不可信。

**数字签名方案的问题：**
数据接收者如何获取正确的公钥呢？如果公钥本身都被篡改了，这个签名方案就不正确了。所以需要有某种方式确保公钥的正确性，这就是数字证书。

---


## 3. 数字证书（Certificate）

**数字证书的作用：**
确保数据接收者的公钥是没有被篡改过的。

**数字证书通常包含以下内容：**
(1) 证书所有人的**公钥**;
(2) 证书发行者对证书的数字**签名**；
(3) 证书所用的签名算法；
(4) 证书发布机构、有效期、所有者的信息等其他信息。

数字证书的验证过程需要用到 **CA根证书** 和 **业务相关证书**，**根证书** 是预装在操作系统中的。

在理解数字证书工作原理之前，我们需要先理解这两种证书是怎么生成的：

**1. CA根证书的生成**
![CA数字证书的生成过程](./2.webp)


步骤：
1. 权威机构利用RSA等算法，生成一对 公钥PK1 / 私钥SK1;
2. 将 公钥PK1 和 证书发布机构、有效期等信息组成一份原始的证书内容，设为 C1；
3. 利用某种摘要算法，计算原始内容 C1 的数字摘要，设为 H1；
4. 用第一步生成的私钥SK1，对摘要H1签名，得到签名内容S1；
5. 将原始内容C1 和 签名内容S1 合在一起，就得到了证书。

根证书安装在操作系统中，我们认为根证书是一定正确的。


**2. 业务相关证书的生成**
![企业申请证书的过程](./3.webp)


步骤：
1. 企业利用RSA等算法，生成一对 公钥PK2 / 私钥SK2；
2. 将 公钥PK2 和 证书其他内容 组成原始证书内容，设为C2，给到权威机构；
3. 权威机构拿到 C2 后，利用摘要算法，生成摘要信息 H2;
4. 权威机构用自己的私钥SK1 (这是关键点)，对摘要信息H2 签名，得到签名内容S2;
5. 将 原始内容C2 和 签名内容S2 合并到一起，得到证书，交给企业。

区别点在于：
业务申请的证书，在签名时用的私钥是CA机构的私钥。这个私钥是和根证书中的公钥对应的。

**3. 数字证书的真伪验证**
有了根证书，我们就能校验其他证书的真伪了：
![证书真伪的验证过程.png](./4.webp)


用根证书的公钥，可以验证其他证书的签名是否正确。如果签名正确，则证书是可信的、没有被篡改的。后续就可以使用这个被信任证书中包含的公钥，去验证收到的消息是否可信了。

用CA证书去证明另外一个证书是否可信，我们可以称之为 证书的递归验证。类似地，我们也可以用一个受信任的证书，去验证其他证书是否可信。